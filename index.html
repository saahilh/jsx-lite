<!DOCTYPE html>

<!-- 
    Warning:
        This project uses an eval call on user input: this can be a major security risk depending on where it is hosted.
        Do not host this on a domain that makes use of cookies to store important data.
        Please read up further on XSS for ways to reduce the risks.
-->

<html>
    <head>
        <meta charset="utf-8" />
        <style>
            html {
                box-sizing: border-box;
                font-family: monospace;
            }

            body {
                margin: 0;
                background-color: #1e1e1e;
                color: #dadada;
            }

            #content {
                margin: auto;
                display: flex;
                flex-wrap: wrap;
                align-items: stretch;
            }

            #content > * {
                min-width: 400px;
                flex: 1 1 50%;
                height: calc(100vh - 47px - 35px);
                overflow: hidden;
            }

            .error {
                color: #d16969;
            }

            #content button {
                width: 200px;
                margin-top: 10px;
            }

            header, footer {
                text-align: center;
                padding: 10px 0 8px 0;
            }

            footer a {
                color: #ffb928;
            }

            footer a:hover {
                color: #9ddfe9;
            }

            header h1 {
                margin: 0;
            }
        </style>

        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="./node_modules/codemirror/lib/codemirror.js"></script>
        <link rel="stylesheet" href="./node_modules/codemirror/lib/codemirror.css">
        <link rel="stylesheet" href="./node_modules/codemirror/theme/mbo.css">
        <script src="./node_modules/codemirror/mode/xml/xml.js"></script>
        <script src="./node_modules/codemirror/mode/javascript/javascript.js"></script>
        <script src="./node_modules/codemirror/mode/jsx/jsx.js"></script>
        <script src="./node_modules/codemirror/keymap/sublime.js"></script>
        <script src="./node_modules/codemirror/addon/edit/matchbrackets.js"></script>
        <script src="./node_modules/codemirror/addon/selection/active-line.js"></script>
        <script src="./node_modules/codemirror/addon/scroll/scrollpastend.js"></script>
        <script src="./node_modules/codemirror/addon/comment/comment.js"></script>
        <script src="./node_modules/codemirror/addon/edit/closebrackets.js"></script>

        <script src="./scripts/jsx-lite.js"></script>
    </head>
    <body>
        <header>
            <h1>JSX-LITE PLAYGROUND</h1>
        </header>
        <div id="content">
            <textarea id="input-jsx"></textarea>
            <div id="output-js"></div>
            <!-- <button onclick="recompileJsx();">Recompile</button> -->
        </div>
        <footer>
            Designed & Built by
            <a rel="noopener" href="https://github.com/saahilh/jsx-lite" aria-label="Open jsx-lite on GitHub" target="_blank">Saahil Hamayun</a>
        </footer>
        <script type="text/javascript">
            Babel.registerPreset("jsx-lite", {
                presets: [[Babel.availablePresets['env']]],
                plugins: [
                    [
                        Babel.availablePlugins["transform-react-jsx"],
                        {
                            "pragma": "JsxLite.createComponent",
                            "pragmaFrag": "JsxLite.createFragment"
                        }
                    ],
                ],
            });

            let defaultSourceValue = `const PageRoot = () => (\n\t<PageContainer>\n\t\t<Example />\n\t</PageContainer>\n);\n\nconst PageContainer = ({ children }) => {\n\tconst getStyle = () => ({\n\t\tbackgroundColor: '#3e3e3e',\n\t\tcolor: '#2c2c2c',\n\t\theight: '100%',\n\t\tdisplay: 'flex',\n\t});\n\n\treturn (\n\t\t<div style={getStyle()}>\n\t\t\t{children}\n\t\t</div>\n\t);\n};\n\nconst Example = () => {\n\tconst getContainerStyle = () => ({\n\t\ttextAlign: 'center',\n\t\tbackgroundColor: '#ffb928',\n\t\twidth: '350px',\n\t\theight: '150px',\n\t\tborderRadius: '2px',\n\t\tmargin: '20px auto 0',\n\t});\n\n\treturn (\n\t\t<div style={getContainerStyle()}>\n\t\t\t<h1>Welcome to the jsx-lite playground</h1>\n\t\t\t<p>Press CTRL+S to recompile this preview</p>\n\t\t\t<p>(changes will be lost on page refresh)</p>\n\t\t</div>\n\t);\n};\n\ndocument.getElementById('output-js').innerHTML = (<PageRoot />);\n`;
            let sourceTextArea = document.getElementById('input-jsx');

            let codeMirrorInstance = CodeMirror(function(elt) {
                sourceTextArea.parentNode.replaceChild(elt, sourceTextArea);
            }, {
                value: defaultSourceValue,
                mode: 'jsx',
                theme: 'mbo',
                keyMap: 'sublime',
                lineNumbers: true,
                tabSize: 2,
                lineWrapping: true,
                extraKeys: {
                    "Ctrl-S": recompileJsx,
                },
                matchBrackets: true,
                comment: true,
                styleActiveLine: true,
                scrollPastEnd: true,
                autoCloseBrackets: true,
            });

            function recompileJsx() {
                let sourceContainer = document.getElementById('input-jsx');
                
                try {
                    eval(Babel.transform(codeMirrorInstance.getValue(), {
                        presets: [[Babel.availablePresets['env']]],
                        plugins: [
                            [
                                Babel.availablePlugins["transform-react-jsx"],
                                {
                                    "pragma": "JsxLite.createComponent",
                                    "pragmaFrag": "JsxLite.createFragment"
                                }
                            ],
                        ],
                    }).code);
                } catch (e) {
                    const errorContainer = document.createElement('pre');
                    errorContainer.className = 'error';
                    const errorMessage = document.createTextNode(e.message);
                    errorContainer.appendChild(errorMessage);

                    let outputContainer = document.getElementById('output-js');
                    outputContainer.innerHTML = '';
                    outputContainer.appendChild(errorContainer);
                }
            };
        </script>
        <script type="text/javascript">recompileJsx();</script>
    </body>
</html>
