<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <style>
            html {
                box-sizing: border-box;
                font-family: monospace;
            }

            #content {
                margin: auto;
                width: 75vw;
            }

            #output-js {
                height: 300px;
            }

            .error {
                color: #d16969;
            }

            #content button {
                width: 200px;
                margin-top: 10px;
            }
        </style>

        <script src="./node_modules/codemirror/lib/codemirror.js"></script>
        <link rel="stylesheet" href="./node_modules/codemirror/lib/codemirror.css">
        <link rel="stylesheet" href="./node_modules/codemirror/theme/ambiance.css">
        <script src="./node_modules/codemirror/mode/xml/xml.js"></script>
        <script src="./node_modules/codemirror/mode/javascript/javascript.js"></script>
        <script src="./node_modules/codemirror/mode/jsx/jsx.js"></script>
        <script src="./node_modules/codemirror/keymap/sublime.js"></script>
        <script src="./scripts/jsx-lite.js"></script>
    </head>
    <body>
        <div id="content">
            <textarea id="input-jsx"></textarea>
            <div id="output-js"></div>
            <button onclick="recompileJsx();">Recompile</button>
        </div>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script type="text/javascript">
            Babel.registerPreset("jsx-lite", {
                presets: [[Babel.availablePresets['env']]],
                plugins: [
                    [
                        Babel.availablePlugins["transform-react-jsx"],
                        {
                            "pragma": "JsxLite.createComponent",
                            "pragmaFrag": "JsxLite.createFragment"
                        }
                    ],
                ],
            });

            let defaultSourceValue = `const PageRoot = () => (
  <PageContainer>
  	<Example />
  </PageContainer>
);

const PageContainer = ({ children }) => {
  const getStyle = () => ({
    backgroundColor: '#1e1e1e',
    color: '#8f9d6a',
    height: '100%',
    display: 'flex',
  });

  return (
    <div style={getStyle()}>
	    {children}
    </div>
  );
};

const Example = () => {
  const getContainerStyle = () => ({
    textAlign: 'center',
    backgroundColor: '#eed1b3',
    width: '250px',
    height: '150px',
    borderRadius: '2px',
    margin: '20px auto 0',
  });

  return (
    <div style={getContainerStyle()}>
      <h1>jsx-lite playground</h1>
      <span>(changes will not be saved)</span>
    </div>
  );
};

let root = document.getElementById('output-js');
root.innerHTML = PageRoot();`;
            let sourceTextArea = document.getElementById('input-jsx');

            let codeMirrorInstance = CodeMirror(function(elt) {
                sourceTextArea.parentNode.replaceChild(elt, sourceTextArea);
            }, {
                value: defaultSourceValue,
                mode: 'jsx',
                theme: 'ambiance',
                keyMap: 'sublime',
                lineNumbers: true,
                tabSize: 2,
            });

            function recompileJsx() {
                let sourceContainer = document.getElementById('input-jsx');
                
                try {
                    eval(Babel.transform(codeMirrorInstance.getValue(), {
                        presets: [[Babel.availablePresets['env']]],
                        plugins: [
                            [
                                Babel.availablePlugins["transform-react-jsx"],
                                {
                                    "pragma": "JsxLite.createComponent",
                                    "pragmaFrag": "JsxLite.createFragment"
                                }
                            ],
                        ],
                    }).code);
                } catch (e) {
                    const errorContainer = document.createElement('pre');
                    errorContainer.className = 'error';
                    const errorMessage = document.createTextNode(e.message);
                    errorContainer.appendChild(errorMessage);

                    let outputContainer = document.getElementById('output-js');
                    outputContainer.innerHTML = '';
                    outputContainer.appendChild(errorContainer);
                }
            };
        </script>
        <script type="text/javascript">recompileJsx();</script>
    </body>
</html>
